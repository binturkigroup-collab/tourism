import{C as y,F as q,a as z,c as K,r as V,R as u,j as s,b as L}from"./app-DiW-XT2R.js";import{B as Q}from"./BlockService-B1hVAasl.js";import{D as X}from"./DurationEnum-Cz9LLErq.js";import{P as Z}from"./PackageEnum-BevYZUUJ.js";import{B as w}from"./BlockCategories-gKFyJIeZ.js";import{u as _}from"./SnackbarHook-CcEHZ6yi.js";import{u as ee,F as te}from"./index.esm-7xo1ZZ6V.js";import{o as I,s as p,a as ae,r as se,b as oe,n as ie,t as re}from"./zod-BSnW4xGW.js";import{V as ne}from"./ValidatedImage-DEOKhPOd.js";import{V as h}from"./ValidatedSelect-DfUES9ev.js";import{V as f}from"./ValidatedInput-B47v1hwj.js";import{B as me}from"./BasicTranslation-Dv8ljBJG.js";import{C as E}from"./CustomButton-nEbszSQU.js";import{C as ce}from"./CustomSnackbar-Dw7l-5cQ.js";import{V as le}from"./ValidatedSwitch-BMI7hK1p.js";import{D as pe}from"./DeleteModal-vG7oVwY-.js";import{B as C}from"./Box-BIlEOssd.js";import{C as de}from"./Chip-D6wlp6tT.js";import{S as j}from"./Send-DwzwYWJL.js";import"./FileService-B_VouSkN.js";import"./CardMedia-D1GDxBwp.js";import"./useSlot-D1jzCan3.js";import"./Icon-Cyiifixs.js";import"./Paper-BW67c0Rd.js";import"./mail-CSA8imBK.js";import"./createLucideIcon-CzejhRRW.js";import"./smartphone-D7WOu-Aq.js";import"./IconButton-Cu0Qh6L-.js";import"./FormHelperText-Cjkp522a.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-D4hgghdo.js";import"./InputAdornment-BF2v1MXS.js";import"./Select-1FYDYG3S.js";import"./Menu-bPvhPpmt.js";import"./isHostComponent-B2iQ8i1a.js";import"./Modal-C_Vi7S8X.js";import"./useControlled--Ee95RYi.js";import"./isMuiElement-tkmUoEbT.js";import"./MenuItem-GJkZjFZB.js";import"./listItemTextClasses-BxSQuiyo.js";import"./toolbar-Bf2-SnO7.js";import"./Button-3jDmhGPp.js";import"./FormControlLabel-BE9UflYY.js";import"./SwitchBase-CAo85LZi.js";const ot=({category:g,block:n,handleBlockChange:ue})=>{const m=y.get(q),i=y.get(Q),d=y.get(z);K().props.settings.languages;const[r,v]=V.useState({...n}),[x,T]=u.useState([]),[b,D]=u.useState(n.tags.map(e=>e.id)),[B,P]=u.useState([]),A=Object.entries(X).map(([e,a])=>({id:e,name:a})),N=Object.entries(Z).map(([e,a])=>({id:e,name:a}));u.useEffect(()=>{async function e(){try{const[a,o]=await Promise.all([i.getActiveBlocks(d.toSnakeCase(w.TAG)),i.getActiveBlocks(d.toSnakeCase(w.CITY))]),[c,$]=await Promise.all([a.data,o.data]);T(c),P($)}catch(a){console.log("Error fetching data",a)}}e()},[]);const{snackbar:S,setSnackbar:l,handleClose:G}=_(),[M,k]=V.useState(!1),F=()=>{k(!1)},H=()=>{k(!0)},O=I({isActive:oe().default(!0),translations:se(p().length(2),I({name:p().min(3,{message:"Title should be at least 3 characters!"}),description:p().max(2e4,{message:" Description shouldn't exceed 20000 characters!"})})),tags:ae(ie()).min(1,"You must choose at least one tag!"),price:p().default("0").refine(e=>m.isNumeric(e),{message:"Estimated value must be a number"}).refine(e=>m.isPositive(e),{message:"Estimated value must be a positive number"}),maxGuests:p().default("0").refine(e=>m.isNumeric(e),{message:"Estimated value must be a number"}).refine(e=>m.isPositive(e),{message:"Estimated value must be a positive number"}).refine(e=>m.isInteger(e),{message:"Estimated value must be an integer"}),minAge:p().default("0").refine(e=>m.isNumeric(e),{message:"Estimated value must be a number"}).refine(e=>m.isPositive(e),{message:"Estimated value must be a positive number"}),duration:p().default("0").refine(e=>m.isNumeric(e),{message:"Estimated value must be a number"}).refine(e=>m.isPositive(e),{message:"Estimated value must be a positive number"})}),t=ee({mode:"onBlur",reValidateMode:"onBlur",resolver:re(O),defaultValues:{isActive:r.isActive,image:null,translations:i.getTranslationsDetails(r.translations),tags:b,cityId:r.cityId,maxGuests:r.maxGuests,minAge:r.minAge,price:r.price,duration:r.duration,unit:r.unit,package:r.tripPackage?n.tripPackage:""}}),R=()=>{const e=r.images.find(o=>o.isCover)?.id||-1,a=new FormData;a.append("image",t.getValues("image")),a.append("imageId",String(e)),i.uploadImage(a,n.id).then(o=>{v(o.data),l(c=>({...c,open:!0,message:"Image has been updated!",severity:"success"}))}).catch(o=>{l(c=>({...c,open:!0,message:"Error Happened while uploading image!",severity:"error"}))})},U=()=>{k(!1),i.deleteBlock(n.id).then(e=>{l(a=>({...a,open:!0,message:"Block has been deleted!",severity:"success"})),L.get("/admin/get-block/"+n.category)}).catch(e=>{l(a=>({...a,open:!0,message:"Error Happened while deleting block!",severity:"error"}))})},Y=e=>{const a=new FormData;a.append("isActive",String(e)),i.blockActivation(a,n.id).then(o=>{v(o.data),l(c=>({...c,open:!0,message:"Block status has been successfully updated!",severity:"success"}))}).catch(o=>{l(c=>({...c,open:!0,message:"Error Happened while updating block status!",severity:"error"}))})},J=()=>{const e=new FormData;e.append("category",g),e.append("isActive",String(t.getValues("isActive"))),e.append("translations",JSON.stringify(t.getValues("translations"))),e.append("isImage","true"),e.append("isCover","true"),e.append("cityId",t.getValues("cityId").toString()),e.append("blockId",String(n.id)),t.getValues("package")!==""&&e.append("package",t.getValues("package")),b.forEach(a=>e.append("tags[]",a.toString())),e.append("price",t.getValues("price").toString()),e.append("maxGuests",t.getValues("maxGuests").toString()),e.append("minAge",t.getValues("minAge").toString()),e.append("duration",t.getValues("duration").toString()),e.append("unit",t.getValues("unit")),e.append("package",t.getValues("package")),i.updateBlock(e,n.id).then(a=>{v(a.data),l(o=>({...o,open:!0,message:"The block has been updated",severity:"success"}))}).catch(a=>{l(o=>({...o,open:!0,message:"Error Happened while updating block",severity:"error"}))})},W=e=>{D(e.target.value)};return u.useEffect(()=>{t.getValues("image")},[t]),s.jsxs(C,{children:[s.jsx(te,{...t,children:s.jsxs(C,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"100%"}},noValidate:!0,autoComplete:"off",onSubmit:t.handleSubmit(J),children:[s.jsx(ne,{controllerName:"image",methods:t,image:i.getBlockImage(n),onUpload:R}),s.jsx(le,{controlName:"isActive",name:"isActive",id:"isActive",color:"secondary",methods:t,label:"Is Active",sendSwitchState:e=>Y(e)}),B.length>0&&s.jsx(h,{control:t.control,controlName:"cityId",id:"cityId",label:"Choose City",placeholder:"City",withNone:!1,items:B.map(e=>({id:e.id,name:i.getBlockName(e)}))}),x.length>0&&s.jsx(h,{control:t.control,controlName:"tags",id:"tags",label:"Tags",placeholder:"Tags",selectChanged:W,multiple:!0,withNone:!1,value:b,renderValue:e=>s.jsx(C,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(a=>s.jsx(de,{label:i.getBlockNameById(a,x)},a))}),items:x.map(e=>({id:e.id,name:i.getBlockName(e)}))}),s.jsxs(j,{direction:"row",justifyContent:"space-evenly",alignItems:"center",spacing:2,className:"m-[8px]",children:[s.jsx(f,{controlName:"price",name:"price",id:"price",label:"Price",placeholder:"Price",control:t.control,adornment:"AED"}),s.jsx(f,{controlName:"maxGuests",name:"maxGuests",id:"maxGuests",label:"Max Guests",placeholder:"Max Guests",control:t.control}),s.jsx(f,{controlName:"minAge",name:"minAge",id:"minAge",label:"Minimum Age",placeholder:"Minimum Age",control:t.control})]}),s.jsxs(j,{direction:"row",justifyContent:"space-evenly",alignItems:"center",spacing:2,className:"m-[8px]",children:[s.jsx(f,{controlName:"duration",name:"duration",id:"duration",label:"Duration",placeholder:"Duration",control:t.control}),A.length>0&&s.jsx(h,{control:t.control,controlName:"unit",id:"unit",label:"Unit",placeholder:"unit",withNone:!1,items:A.map(e=>({id:e.name,name:e.name}))}),N.length>0&&s.jsx(h,{control:t.control,controlName:"package",id:"package",label:"Package",placeholder:"Package",withNone:!0,items:N.map(e=>({id:e.name,name:e.name}))})]}),s.jsx(me,{methods:t,category:d.toTitleCase(g),withBrief:!1}),s.jsxs(j,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,className:"m-[8px]",children:[s.jsx(E,{task:"update",text:d.toTitleCase(g)}),s.jsx(E,{task:"delete",text:d.toTitleCase(g),onClick:H})]})]})}),s.jsx(ce,{open:S.open,message:S.message,onClose:G,severity:S.severity}),s.jsx(pe,{open:M,onClose:F,message:`Are you sure that you want to delete ${i.getBlockName(r)}`,confirmDelete:U})]})};export{ot as default};
